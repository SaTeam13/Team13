<template>
  <v-container>
    <v-layout text-center wrap>
      <v-flex mb-4>
        <br />
        <h1 class="display-1 font-weight-bold mb-3">Reservation</h1>
      </v-flex>
    </v-layout>
    <v-row justify="center">
      <v-col cols="10">
        <v-data-table :headers="headers" :items="items" :items-per-page="5" class="elevation-1">
        </v-data-table>
      </v-col>
    </v-row>

    <v-row justify="center">
            <v-col cols="3">
              <v-text-field
                outlined
                label="ต้องการลบ ID: "
                v-model="reservation.reservationId"
                required
              ></v-text-field>
              <p v-if="reservationCheck != ''">ID การจองที่จะทำการลบ : {{reservationId}}
                <v-btn class="mx-8" @click="deleteReservation" color="#D50000" style="color:#FFFFFF" >ลบ</v-btn>
              </p>
            </v-col>
            <v-col cols="2">
              <div class="my-2; mx-5">
                <v-btn @click="findReservation" depressed large color="#000000" style="color:#FFFFFF;margin-bottom:20px">ยืนยัน</v-btn>
              </div>
            </v-col>
          </v-row>
  </v-container>
</template>

<script>
import http from "../http-common";

export default {
  name: "viewReservation",
  data() {
    return {
      headers: [
        {
          text: "ผู้ใช้บริการ",
          align: "left",
          sortable: false,
          value: "customer.customername"
        },
        { text: "ID ผู้ใช้บริการ", value: "customer.customerid" },
        { text: "สนามที่จอง", value: "fieldcategory.field" },
        { text: "วันที่จอง", value: "reservedate" },
        { text: "เวลาที่จอง", value: "timetable.timeString" },
        { text: "ทำรายการโดย", value: "employee.employeename" },
        { text: "ID การจอง", value: "reservationid" },
      ],
      items: [],
       reservation: {
        reservationId: "",
      },
      valid: false,
      reservationCheck: false,
      reservationId: "",
    };
  },
  methods: {
    /* eslint-disable no-console */
    getReservations() {
      http
        .get("/reservation")
        .then(response => {
          this.items = response.data;
          console.log(this.items);
        })
        .catch(e => {
          console.log(e);
        });
    },
    findReservation() {
      http
        .get("/reservation/" + this.reservation.reservationId)
        .then(response => {
          console.log(response);
          if (response.data != null) {
            this.reservationId = response.data.reservationid;
            this.reservationCheck = response.status;
          } else {
            this.clear()
          }          
        })
        .catch(e => {
          console.log(e);
        });
      this.submitted = true;
    },
    deleteReservation() {
      http
        .delete("/reservation/" + this.reservation.reservationId)
        .then(response => {
          console.log(response.data);
          this.$emit("refreshData");
          alert("ทำการลบรายการจองเรียบร้อย");
          location.reload();
        })
        .catch(e => {
          console.log(e);
        });
    },
    refreshList() {
      this.getReservations();
    }
    /* eslint-disable no-console */
  },
  mounted() {
    this.getReservations();
  }
};
</script>
